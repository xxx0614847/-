<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="‰ΩøÁî®ÈÇÆÁÆ±È™åËØÅÁ†ÅÂø´ÈÄüÁôªÂΩïÊàñÊ≥®ÂÜå">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ÈÇÆÁÆ±È™åËØÅÁ†ÅÁôªÂΩï - ÊòüÁ©∫Êº©Ê∂°Áâà v4.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #00d4ff;
            --secondary-color: #7c3aed;
            --accent-color: #f59e0b;
            --bg-dark: #0a0e1a;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --card-bg: rgba(15, 20, 32, 0.9);
            --glow-primary: rgba(0, 212, 255, 0.3);
            --glow-secondary: rgba(124, 58, 237, 0.3);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a1628;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        /* Ê∑±ËìùËâ≤ÊòüÁ©∫Êº©Ê∂°ËÉåÊôØ */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at 40% 30%, rgba(30, 144, 255, 0.4) 0%, rgba(30, 144, 255, 0.15) 20%, transparent 45%),
                radial-gradient(ellipse at 60% 50%, rgba(0, 191, 255, 0.35) 0%, rgba(0, 191, 255, 0.1) 25%, transparent 50%),
                radial-gradient(ellipse at 30% 70%, rgba(65, 105, 225, 0.3) 0%, transparent 40%),
                radial-gradient(ellipse at 80% 40%, rgba(100, 149, 237, 0.25) 0%, transparent 35%),
                radial-gradient(circle at 50% 50%, rgba(70, 130, 180, 0.2) 0%, transparent 60%);
            animation: galaxySwirl 40s ease-in-out infinite;
            z-index: 0;
        }
        
        @keyframes galaxySwirl {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 1;
            }
            25% {
                transform: translate(-3%, 3%) rotate(90deg) scale(1.05);
                opacity: 0.9;
            }
            50% {
                transform: translate(0, 0) rotate(180deg) scale(1);
                opacity: 1;
            }
            75% {
                transform: translate(3%, -3%) rotate(270deg) scale(1.05);
                opacity: 0.9;
            }
        }
        
        /* Êòé‰∫ÆÁöÑËìùËâ≤ÂÖâÂ∏¶ */
        .light-band {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(135deg, transparent 30%, rgba(0, 191, 255, 0.3) 45%, rgba(30, 144, 255, 0.4) 50%, rgba(0, 191, 255, 0.3) 55%, transparent 70%),
                linear-gradient(45deg, transparent 40%, rgba(100, 149, 237, 0.2) 48%, rgba(135, 206, 250, 0.3) 52%, transparent 60%);
            animation: lightFlow 25s linear infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes lightFlow {
            0% { transform: translateX(-100%) translateY(-100%) rotate(0deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(360deg); }
        }
        
        /* Êï£ËêΩÁöÑÊòüÁÇπ */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 15% 20%, rgba(255, 255, 255, 0.9), transparent),
                radial-gradient(1px 1px at 25% 35%, rgba(173, 216, 230, 0.8), transparent),
                radial-gradient(3px 3px at 45% 15%, rgba(255, 255, 255, 1), transparent),
                radial-gradient(1px 1px at 55% 45%, rgba(135, 206, 250, 0.7), transparent),
                radial-gradient(2px 2px at 70% 25%, rgba(255, 255, 255, 0.85), transparent),
                radial-gradient(1px 1px at 80% 60%, rgba(176, 224, 230, 0.8), transparent),
                radial-gradient(2px 2px at 35% 70%, rgba(255, 255, 255, 0.9), transparent),
                radial-gradient(1px 1px at 60% 80%, rgba(135, 206, 250, 0.75), transparent),
                radial-gradient(3px 3px at 85% 40%, rgba(255, 255, 255, 0.95), transparent),
                radial-gradient(1px 1px at 20% 55%, rgba(173, 216, 230, 0.7), transparent),
                radial-gradient(2px 2px at 90% 75%, rgba(255, 255, 255, 0.8), transparent),
                radial-gradient(1px 1px at 40% 90%, rgba(135, 206, 250, 0.8), transparent);
            background-size: 250% 250%;
            background-position: 0% 0%;
            animation: starsTwinkle 80s linear infinite;
            opacity: 0.8;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes starsTwinkle {
            0% { 
                background-position: 0% 0%; 
                opacity: 0.8;
            }
            50% { 
                opacity: 1;
            }
            100% { 
                background-position: 100% 100%; 
                opacity: 0.8;
            }
        }
        
        /* Â∫ïÈÉ®Ê∑±Ëâ≤Â±±Â≥¶ - ÂçäÈÄèÊòé */
        .mountains {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 35%;
            background: 
                linear-gradient(to top, rgba(10, 22, 40, 0.9) 0%, transparent 100%),
                polygon(0% 100%, 0% 60%, 15% 45%, 25% 55%, 35% 40%, 50% 50%, 65% 35%, 75% 45%, 85% 40%, 100% 55%, 100% 100%);
            clip-path: polygon(
                0% 100%, 
                0% 60%, 
                8% 65%, 
                15% 50%, 
                22% 55%, 
                30% 45%, 
                38% 50%, 
                45% 40%, 
                52% 48%, 
                60% 42%, 
                68% 50%, 
                75% 45%, 
                82% 52%, 
                90% 48%, 
                100% 58%, 
                100% 100%
            );
            opacity: 0.6;
            pointer-events: none;
            z-index: 1;
        }
        
        .container {
            width: 100%;
            max-width: 480px;
            position: relative;
            z-index: 10;
        }
        
        .auth-card {
            background: rgba(15, 25, 45, 0.85);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(30, 144, 255, 0.3);
            border-radius: 20px;
            padding: 48px 40px;
            width: 100%;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.5),
                0 0 60px rgba(30, 144, 255, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .auth-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(30, 144, 255, 0.8), rgba(0, 191, 255, 1), rgba(30, 144, 255, 0.8), transparent);
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.6);
        }
        
        h1 {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            text-align: center;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 40px;
            font-size: 16px;
            font-weight: 400;
        }
        
        .form-group {
            margin-bottom: 24px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-weight: 500;
            font-size: 14px;
        }
        
        input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(10, 14, 26, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s;
            outline: none;
        }
        
        input::placeholder {
            color: var(--text-secondary);
        }
        
        input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 20px var(--glow-primary);
            background: rgba(0, 212, 255, 0.05);
        }
        
        input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .otp-group {
            display: flex;
            gap: 12px;
        }
        
        .otp-group input {
            flex: 1;
        }
        
        button {
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover:not(:disabled)::before {
            width: 300px;
            height: 300px;
        }
        
        button:hover:not(:disabled) {
            box-shadow: 0 0 30px var(--glow-primary);
            transform: translateY(-2px);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        button:disabled {
            background: rgba(100, 100, 100, 0.3);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .submit-btn {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            margin-top: 12px;
        }
        
        .error-message {
            display: block;
            color: var(--neon-pink);
            font-size: 18px;
            margin-top: 10px;
            min-height: 22px;
            font-weight: 400;
            letter-spacing: 1px;
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        .message {
            margin-top: 25px;
            padding: 18px 22px;
            font-size: 20px;
            text-align: center;
            display: none;
            border: 2px solid;
            font-weight: 400;
            letter-spacing: 1px;
            animation: messageSlide 0.5s ease-out;
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.success {
            background: rgba(0, 255, 255, 0.1);
            color: var(--neon-cyan);
            border-color: var(--neon-cyan);
            display: block;
            box-shadow: 
                0 0 20px var(--neon-cyan),
                inset 0 0 20px rgba(0, 255, 255, 0.2);
            text-shadow: 0 0 10px var(--neon-cyan);
        }
        
        .message.error {
            background: rgba(255, 0, 255, 0.1);
            color: var(--neon-pink);
            border-color: var(--neon-pink);
            display: block;
            box-shadow: 
                0 0 20px var(--neon-pink),
                inset 0 0 20px rgba(255, 0, 255, 0.2);
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        .message.info {
            background: rgba(157, 0, 255, 0.1);
            color: var(--neon-purple);
            border-color: var(--neon-purple);
            display: block;
            box-shadow: 
                0 0 20px var(--neon-purple),
                inset 0 0 20px rgba(157, 0, 255, 0.2);
            text-shadow: 0 0 10px var(--neon-purple);
        }
        
        /* ÂÉèÁ¥†ÂåñÊï∞ÊçÆÊµÅ */
        .data-stream {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.15;
        }
        
        .data-stream span {
            position: absolute;
            font-family: 'VT323', monospace;
            font-size: 20px;
            font-weight: bold;
            animation: dataFall linear infinite;
        }
        
        .data-stream span:nth-child(odd) {
            color: var(--neon-cyan);
            text-shadow: 0 0 10px var(--neon-cyan);
        }
        
        .data-stream span:nth-child(even) {
            color: var(--neon-pink);
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        @keyframes dataFall {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }
        
        /* Êâ´ÊèèÁ∫øÊïàÊûú */
        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 255, 0.05) 2px,
                rgba(0, 255, 255, 0.05) 4px
            );
            pointer-events: none;
            z-index: 999;
            animation: scanlineMove 8s linear infinite;
        }
        
        @keyframes scanlineMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }
        
        @media (max-width: 768px) {
            .container {
                max-width: 90%;
            }
            
            .auth-card {
                padding: 35px 25px;
            }
            
            h1 {
                font-size: 22px;
                letter-spacing: 2px;
            }
            
            .subtitle {
                font-size: 16px;
            }
            
            label {
                font-size: 16px;
            }
            
            input {
                font-size: 20px;
                padding: 16px;
            }
            
            button {
                font-size: 14px;
                padding: 16px 20px;
            }
            
            .submit-btn {
                font-size: 16px;
            }
            
            .otp-group {
                flex-direction: column;
            }
            
            .otp-group button {
                width: 100%;
            }
        }
        
        .hidden { display: none; }

    </style>
</head>
<body>
    <div class="light-band"></div>
    <div class="mountains"></div>
    <div class="container">
        <div class="auth-card">
            <!-- ÁôªÂΩïÈ°µÈù¢ -->
            <div id="loginPage">
                <h1>Ê¨¢ËøéËÆøÈóÆ</h1>
                <p class="subtitle">ÈÇÆÁÆ±È™åËØÅÁôªÂΩï</p>
                
                <!-- ÁôªÂΩïÊñπÂºèÈÄâÊã© -->
                <div class="form-group">
                    <label>ÁôªÂΩïÊñπÂºè</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button type="button" id="otpModeBtn" onclick="switchToOtpMode()" style="flex: 1;">È™åËØÅÁ†ÅÁôªÂΩï</button>
                        <button type="button" id="passwordModeBtn" onclick="switchToPasswordMode()" style="flex: 1;">ÂØÜÁ†ÅÁôªÂΩï</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="loginEmail">ÈÇÆÁÆ±Âú∞ÂùÄ</label>
                    <input type="email" id="loginEmail" placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±Âú∞ÂùÄ" />
                    <span class="error-message" id="loginEmailError"></span>
                </div>
                
                <!-- È™åËØÅÁ†ÅÁôªÂΩïÂå∫Âüü -->
                <div id="otpLoginSection">
                    <div class="form-group">
                        <label for="loginOtp">È™åËØÅÁ†Å</label>
                        <div class="otp-group">
                            <input type="text" id="loginOtp" placeholder="ËØ∑ËæìÂÖ•8‰ΩçÈ™åËØÅÁ†Å" maxlength="8" disabled />
                            <button id="sendOtpBtn" onclick="sendLoginOTP()">Ëé∑ÂèñÈ™åËØÅÁ†Å</button>
                        </div>
                        <span class="error-message" id="loginOtpError"></span>
                    </div>
                </div>
                
                <!-- ÂØÜÁ†ÅÁôªÂΩïÂå∫Âüü -->
                <div id="passwordLoginSection" style="display: none;">
                    <div class="form-group">
                        <label for="loginPassword">ÂØÜÁ†Å</label>
                        <input type="password" id="loginPassword" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" />
                        <span class="error-message" id="loginPasswordError"></span>
                    </div>
                </div>
                
                <button class="submit-btn" id="loginBtn" onclick="handleLogin()" disabled>ÁôªÂΩï</button>
                
                <div style="text-align: center; margin-top: 25px;">
                    <span style="color: var(--neon-cyan); font-size: 20px; letter-spacing: 1px;">ËøòÊ≤°ÊúâË¥¶Âè∑Ôºü</span>
                    <button onclick="showRegisterPage()" style="background: transparent; border: none; color: var(--neon-pink); text-decoration: underline; cursor: pointer; font-size: 20px; padding: 0 10px; font-family: 'VT323', monospace;">Á´ãÂç≥Ê≥®ÂÜå</button>
                </div>
            </div>
            
            <!-- Ê≥®ÂÜåÈ°µÈù¢ -->
            <div id="registerPage" style="display: none;">
                <h1>Êñ∞Áî®Êà∑Ê≥®ÂÜå</h1>
                <p class="subtitle">È™åËØÅÈÇÆÁÆ±Âπ∂ËÆæÁΩÆÂØÜÁ†Å</p>
                
                <div class="form-group">
                    <label for="registerEmail">ÈÇÆÁÆ±Âú∞ÂùÄ</label>
                    <input type="email" id="registerEmail" placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±Âú∞ÂùÄ" />
                    <span class="error-message" id="registerEmailError"></span>
                </div>
                
                <div class="form-group">
                    <label for="registerOtp">È™åËØÅÁ†Å</label>
                    <div class="otp-group">
                        <input type="text" id="registerOtp" placeholder="ËØ∑ËæìÂÖ•8‰ΩçÈ™åËØÅÁ†Å" maxlength="8" disabled />
                        <button id="sendRegisterOtpBtn" onclick="sendRegisterOTP()">Ëé∑ÂèñÈ™åËØÅÁ†Å</button>
                    </div>
                    <span class="error-message" id="registerOtpError"></span>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">ËÆæÁΩÆÂØÜÁ†Å</label>
                    <input type="password" id="registerPassword" placeholder="ËØ∑ËÆæÁΩÆÂØÜÁ†ÅÔºàËá≥Â∞ë6‰ΩçÔºâ" />
                    <span class="error-message" id="registerPasswordError"></span>
                </div>
                
                <div class="form-group">
                    <label for="registerConfirmPassword">Á°ÆËÆ§ÂØÜÁ†Å</label>
                    <input type="password" id="registerConfirmPassword" placeholder="ËØ∑ÂÜçÊ¨°ËæìÂÖ•ÂØÜÁ†Å" />
                    <span class="error-message" id="registerConfirmPasswordError"></span>
                </div>
                
                <button class="submit-btn" id="registerBtn" onclick="handleRegister()" disabled>ÂÆåÊàêÊ≥®ÂÜå</button>
                
                <div style="text-align: center; margin-top: 25px;">
                    <span style="color: var(--neon-cyan); font-size: 20px; letter-spacing: 1px;">Â∑≤ÊúâË¥¶Âè∑Ôºü</span>
                    <button onclick="showLoginPage()" style="background: transparent; border: none; color: var(--neon-pink); text-decoration: underline; cursor: pointer; font-size: 20px; padding: 0 10px; font-family: 'VT323', monospace;">ËøîÂõûÁôªÂΩï</button>
                </div>
            </div>
            
            <div id="sendResult" class="message"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const CONFIG = {
            url: 'https://zgfyqhhvotaunytjtcxi.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpnZnlxaGh2b3RhdW55dGp0Y3hpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDkxMDIsImV4cCI6MjA4NjM4NTEwMn0.C9mSuankyh-IvSlC91smtpWnodfyGcM7gylmFZChJ4A'
        };
        
        let supabaseClient = window.supabase.createClient(CONFIG.url, CONFIG.key);
        let loginCountdown = 0;
        let registerCountdown = 0;
        let loginTimer = null;
        let registerTimer = null;
        let loginMode = 'otp'; // 'otp' or 'password'
        
        function showMessage(text, type) {
            const msg = document.getElementById('sendResult');
            msg.textContent = text;
            msg.className = `message ${type}`;
        }
        
        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        // ÂàáÊç¢Âà∞ÁôªÂΩïÈ°µÈù¢
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('registerPage').style.display = 'none';
            showMessage('', '');
            clearAllInputs('register');
        }
        
        // ÂàáÊç¢Âà∞Ê≥®ÂÜåÈ°µÈù¢
        function showRegisterPage() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'block';
            showMessage('', '');
            clearAllInputs('login');
        }
        
        // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
        function clearAllInputs(page) {
            if (page === 'login') {
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginOtp').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginEmailError').textContent = '';
                document.getElementById('loginOtpError').textContent = '';
                document.getElementById('loginPasswordError').textContent = '';
            } else {
                document.getElementById('registerEmail').value = '';
                document.getElementById('registerOtp').value = '';
                document.getElementById('registerPassword').value = '';
                document.getElementById('registerConfirmPassword').value = '';
                document.getElementById('registerEmailError').textContent = '';
                document.getElementById('registerOtpError').textContent = '';
                document.getElementById('registerPasswordError').textContent = '';
                document.getElementById('registerConfirmPasswordError').textContent = '';
            }
        }
        
        // ÂàáÊç¢Âà∞È™åËØÅÁ†ÅÁôªÂΩïÊ®°Âºè
        function switchToOtpMode() {
            loginMode = 'otp';
            document.getElementById('otpLoginSection').style.display = 'block';
            document.getElementById('passwordLoginSection').style.display = 'none';
            document.getElementById('otpModeBtn').style.opacity = '1';
            document.getElementById('passwordModeBtn').style.opacity = '0.5';
            updateLoginButton();
        }
        
        // ÂàáÊç¢Âà∞ÂØÜÁ†ÅÁôªÂΩïÊ®°Âºè
        function switchToPasswordMode() {
            loginMode = 'password';
            document.getElementById('otpLoginSection').style.display = 'none';
            document.getElementById('passwordLoginSection').style.display = 'block';
            document.getElementById('otpModeBtn').style.opacity = '0.5';
            document.getElementById('passwordModeBtn').style.opacity = '1';
            updateLoginButton();
        }
        
        // Êõ¥Êñ∞ÁôªÂΩïÊåâÈíÆÁä∂ÊÄÅ
        function updateLoginButton() {
            const loginBtn = document.getElementById('loginBtn');
            const email = document.getElementById('loginEmail').value.trim();
            
            if (!validateEmail(email)) {
                loginBtn.disabled = true;
                return;
            }
            
            if (loginMode === 'otp') {
                const otp = document.getElementById('loginOtp').value;
                loginBtn.disabled = otp.length !== 8;
            } else {
                const password = document.getElementById('loginPassword').value;
                loginBtn.disabled = !password || password.length < 6;
            }
        }
        
        // Êõ¥Êñ∞Ê≥®ÂÜåÊåâÈíÆÁä∂ÊÄÅ
        function updateRegisterButton() {
            const registerBtn = document.getElementById('registerBtn');
            const email = document.getElementById('registerEmail').value.trim();
            const otp = document.getElementById('registerOtp').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            registerBtn.disabled = !validateEmail(email) || otp.length !== 8 || 
                                   password.length < 6 || password !== confirmPassword;
        }
        
        // ========== ÁôªÂΩïÈ°µÈù¢‰∫ã‰ª∂ ==========
        
        // ÁôªÂΩïÈÇÆÁÆ±ËæìÂÖ•È™åËØÅ
        document.getElementById('loginEmail').addEventListener('input', function() {
            const email = this.value.trim();
            const errorEl = document.getElementById('loginEmailError');
            const sendBtn = document.getElementById('sendOtpBtn');
            
            errorEl.textContent = '';
            
            if (email && !validateEmail(email)) {
                errorEl.textContent = 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈÇÆÁÆ±Âú∞ÂùÄ';
                sendBtn.disabled = true;
            } else if (email) {
                sendBtn.disabled = loginCountdown > 0;
            } else {
                sendBtn.disabled = true;
            }
            
            updateLoginButton();
        });
        
        // ÁôªÂΩïÈ™åËØÅÁ†ÅËæìÂÖ•È™åËØÅ
        document.getElementById('loginOtp').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').slice(0, 8);
            document.getElementById('loginOtpError').textContent = '';
            updateLoginButton();
        });
        
        // ÁôªÂΩïÂØÜÁ†ÅËæìÂÖ•È™åËØÅ
        document.getElementById('loginPassword').addEventListener('input', function() {
            document.getElementById('loginPasswordError').textContent = '';
            updateLoginButton();
        });
        
        // ÂèëÈÄÅÁôªÂΩïÈ™åËØÅÁ†Å
        async function sendLoginOTP() {
            const email = document.getElementById('loginEmail').value.trim();
            const sendBtn = document.getElementById('sendOtpBtn');
            const otpInput = document.getElementById('loginOtp');
            
            document.getElementById('loginEmailError').textContent = '';
            
            if (!validateEmail(email)) {
                document.getElementById('loginEmailError').textContent = 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈÇÆÁÆ±Âú∞ÂùÄ';
                return;
            }
            
            sendBtn.disabled = true;
            sendBtn.textContent = 'ÂèëÈÄÅ‰∏≠...';
            showMessage('', '');
            
            try {
                const { error } = await supabaseClient.auth.signInWithOtp({
                    email: email,
                    options: { shouldCreateUser: false }
                });
                
                if (error) throw error;
                
                showMessage('‚úÖ È™åËØÅÁ†ÅÂ∑≤ÂèëÈÄÅÂà∞ÊÇ®ÁöÑÈÇÆÁÆ±Ôºà8‰ΩçÊï∞Â≠óÔºâ', 'success');
                otpInput.disabled = false;
                otpInput.focus();
                
                // ÂÄíËÆ°Êó∂
                loginCountdown = 60;
                sendBtn.textContent = `${loginCountdown}ÁßíÂêéÈáçËØï`;
                
                loginTimer = setInterval(() => {
                    loginCountdown--;
                    if (loginCountdown <= 0) {
                        clearInterval(loginTimer);
                        sendBtn.disabled = false;
                        sendBtn.textContent = 'ÈáçÊñ∞Ëé∑Âèñ';
                    } else {
                        sendBtn.textContent = `${loginCountdown}ÁßíÂêéÈáçËØï`;
                    }
                }, 1000);
                
            } catch (error) {
                console.error('ÂèëÈÄÅÂ§±Ë¥•:', error);
                showMessage('‚ùå ' + (error.message || 'ÂèëÈÄÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï'), 'error');
                sendBtn.disabled = false;
                sendBtn.textContent = 'Ëé∑ÂèñÈ™åËØÅÁ†Å';
            }
        }
        
        // Â§ÑÁêÜÁôªÂΩï
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'ÁôªÂΩï‰∏≠...';
            showMessage('', '');
            
            try {
                if (loginMode === 'otp') {
                    // È™åËØÅÁ†ÅÁôªÂΩï
                    const otp = document.getElementById('loginOtp').value.trim();
                    
                    if (otp.length !== 8) {
                        document.getElementById('loginOtpError').textContent = 'ËØ∑ËæìÂÖ•8‰ΩçÈ™åËØÅÁ†Å';
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'ÁôªÂΩï';
                        return;
                    }
                    
                    const { data, error } = await supabaseClient.auth.verifyOtp({
                        email: email,
                        token: otp,
                        type: 'email'
                    });
                    
                    if (error) throw error;
                    
                    showMessage('üéâ ÁôªÂΩïÊàêÂäüÔºÅÊ¨¢ËøéÔºå' + data.user.email, 'success');
                    console.log('Áî®Êà∑‰ø°ÊÅØ:', data);
                    
                    // ÁôªÂΩïÊàêÂäüÂêéË∑≥ËΩ¨Âà∞Êï∞ÊçÆ‰∏≠Âè∞È°µÈù¢
                    setTimeout(() => { window.location.href = 'dashboard.html'; }, 1500);
                    
                } else {
                    // ÂØÜÁ†ÅÁôªÂΩï
                    const password = document.getElementById('loginPassword').value;
                    
                    if (!password || password.length < 6) {
                        document.getElementById('loginPasswordError').textContent = 'ËØ∑ËæìÂÖ•ÂØÜÁ†Å';
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'ÁôªÂΩï';
                        return;
                    }
                    
                    const { data, error } = await supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) throw error;
                    
                    showMessage('üéâ ÁôªÂΩïÊàêÂäüÔºÅÊ¨¢ËøéÔºå' + data.user.email, 'success');
                    console.log('Áî®Êà∑‰ø°ÊÅØ:', data);
                    
                    // ÁôªÂΩïÊàêÂäüÂêéË∑≥ËΩ¨Âà∞Êï∞ÊçÆ‰∏≠Âè∞È°µÈù¢
                    setTimeout(() => { window.location.href = 'dashboard.html'; }, 1500);
                }
                
            } catch (error) {
                console.error('ÁôªÂΩïÂ§±Ë¥•:', error);
                showMessage('‚ùå ' + (error.message || 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÂá≠ÊçÆ'), 'error');
                loginBtn.disabled = false;
                loginBtn.textContent = 'ÁôªÂΩï';
                
                if (loginMode === 'otp') {
                    document.getElementById('loginOtp').value = '';
                }
            }
        }
        
        // ========== Ê≥®ÂÜåÈ°µÈù¢‰∫ã‰ª∂ ==========
        
        // Ê≥®ÂÜåÈÇÆÁÆ±ËæìÂÖ•È™åËØÅ
        document.getElementById('registerEmail').addEventListener('input', function() {
            const email = this.value.trim();
            const errorEl = document.getElementById('registerEmailError');
            const sendBtn = document.getElementById('sendRegisterOtpBtn');
            
            errorEl.textContent = '';
            
            if (email && !validateEmail(email)) {
                errorEl.textContent = 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈÇÆÁÆ±Âú∞ÂùÄ';
                sendBtn.disabled = true;
            } else if (email) {
                sendBtn.disabled = registerCountdown > 0;
            } else {
                sendBtn.disabled = true;
            }
            
            updateRegisterButton();
        });
        
        // Ê≥®ÂÜåÈ™åËØÅÁ†ÅËæìÂÖ•È™åËØÅ
        document.getElementById('registerOtp').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').slice(0, 8);
            document.getElementById('registerOtpError').textContent = '';
            updateRegisterButton();
        });
        
        // Ê≥®ÂÜåÂØÜÁ†ÅËæìÂÖ•È™åËØÅ
        document.getElementById('registerPassword').addEventListener('input', function() {
            const errorEl = document.getElementById('registerPasswordError');
            errorEl.textContent = '';
            if (this.value && this.value.length < 6) {
                errorEl.textContent = 'ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å6‰Ωç';
            }
            updateRegisterButton();
        });
        
        // Á°ÆËÆ§ÂØÜÁ†ÅËæìÂÖ•È™åËØÅ
        document.getElementById('registerConfirmPassword').addEventListener('input', function() {
            const errorEl = document.getElementById('registerConfirmPasswordError');
            const password = document.getElementById('registerPassword').value;
            errorEl.textContent = '';
            if (this.value && this.value !== password) {
                errorEl.textContent = '‰∏§Ê¨°ÂØÜÁ†Å‰∏ç‰∏ÄËá¥';
            }
            updateRegisterButton();
        });
        
        // ÂèëÈÄÅÊ≥®ÂÜåÈ™åËØÅÁ†Å
        async function sendRegisterOTP() {
            const email = document.getElementById('registerEmail').value.trim();
            const sendBtn = document.getElementById('sendRegisterOtpBtn');
            const otpInput = document.getElementById('registerOtp');
            
            document.getElementById('registerEmailError').textContent = '';
            
            if (!validateEmail(email)) {
                document.getElementById('registerEmailError').textContent = 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈÇÆÁÆ±Âú∞ÂùÄ';
                return;
            }
            
            sendBtn.disabled = true;
            sendBtn.textContent = 'ÂèëÈÄÅ‰∏≠...';
            showMessage('', '');
            
            try {
                const { error } = await supabaseClient.auth.signInWithOtp({
                    email: email,
                    options: { shouldCreateUser: true }
                });
                
                if (error) throw error;
                
                showMessage('‚úÖ È™åËØÅÁ†ÅÂ∑≤ÂèëÈÄÅÂà∞ÊÇ®ÁöÑÈÇÆÁÆ±Ôºà8‰ΩçÊï∞Â≠óÔºâ', 'success');
                otpInput.disabled = false;
                otpInput.focus();
                
                // ÂÄíËÆ°Êó∂
                registerCountdown = 60;
                sendBtn.textContent = `${registerCountdown}ÁßíÂêéÈáçËØï`;
                
                registerTimer = setInterval(() => {
                    registerCountdown--;
                    if (registerCountdown <= 0) {
                        clearInterval(registerTimer);
                        sendBtn.disabled = false;
                        sendBtn.textContent = 'ÈáçÊñ∞Ëé∑Âèñ';
                    } else {
                        sendBtn.textContent = `${registerCountdown}ÁßíÂêéÈáçËØï`;
                    }
                }, 1000);
                
            } catch (error) {
                console.error('ÂèëÈÄÅÂ§±Ë¥•:', error);
                showMessage('‚ùå ' + (error.message || 'ÂèëÈÄÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï'), 'error');
                sendBtn.disabled = false;
                sendBtn.textContent = 'Ëé∑ÂèñÈ™åËØÅÁ†Å';
            }
        }
        
        // Â§ÑÁêÜÊ≥®ÂÜå
        async function handleRegister() {
            const email = document.getElementById('registerEmail').value.trim();
            const otp = document.getElementById('registerOtp').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const registerBtn = document.getElementById('registerBtn');
            
            // È™åËØÅ
            document.getElementById('registerEmailError').textContent = '';
            document.getElementById('registerOtpError').textContent = '';
            document.getElementById('registerPasswordError').textContent = '';
            document.getElementById('registerConfirmPasswordError').textContent = '';
            
            if (!validateEmail(email)) {
                document.getElementById('registerEmailError').textContent = 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈÇÆÁÆ±Âú∞ÂùÄ';
                return;
            }
            
            if (otp.length !== 8) {
                document.getElementById('registerOtpError').textContent = 'ËØ∑ËæìÂÖ•8‰ΩçÈ™åËØÅÁ†Å';
                return;
            }
            
            if (password.length < 6) {
                document.getElementById('registerPasswordError').textContent = 'ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å6‰Ωç';
                return;
            }
            
            if (password !== confirmPassword) {
                document.getElementById('registerConfirmPasswordError').textContent = '‰∏§Ê¨°ÂØÜÁ†Å‰∏ç‰∏ÄËá¥';
                return;
            }
            
            registerBtn.disabled = true;
            registerBtn.textContent = 'Ê≥®ÂÜå‰∏≠...';
            showMessage('', '');
            
            try {
                // ÂÖàÈ™åËØÅOTP
                const { data, error } = await supabaseClient.auth.verifyOtp({
                    email: email,
                    token: otp,
                    type: 'email'
                });
                
                if (error) throw error;
                
                // È™åËØÅÊàêÂäüÂêéËÆæÁΩÆÂØÜÁ†Å
                const { error: updateError } = await supabaseClient.auth.updateUser({
                    password: password
                });
                
                if (updateError) throw updateError;
                
                showMessage('üéâ Ê≥®ÂÜåÊàêÂäüÔºÅÊ¨¢ËøéÔºå' + email, 'success');
                console.log('Áî®Êà∑‰ø°ÊÅØ:', data);
                
                // Ê≥®ÂÜåÊàêÂäüÂêéË∑≥ËΩ¨Âà∞Êï∞ÊçÆ‰∏≠Âè∞È°µÈù¢
                setTimeout(() => { window.location.href = 'dashboard.html'; }, 1500);
                
            } catch (error) {
                console.error('Ê≥®ÂÜåÂ§±Ë¥•:', error);
                showMessage('‚ùå ' + (error.message || 'Ê≥®ÂÜåÂ§±Ë¥•ÔºåËØ∑ÈáçËØï'), 'error');
                registerBtn.disabled = false;
                registerBtn.textContent = 'ÂÆåÊàêÊ≥®ÂÜå';
                document.getElementById('registerOtp').value = '';
            }
        }
        
        // ÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            document.getElementById('sendOtpBtn').disabled = true;
            document.getElementById('sendRegisterOtpBtn').disabled = true;
            document.getElementById('loginBtn').disabled = true;
            document.getElementById('registerBtn').disabled = true;
            document.getElementById('otpModeBtn').style.opacity = '1';
            document.getElementById('passwordModeBtn').style.opacity = '0.5';
        });
        
        window.addEventListener('load', checkAuth);
    </script>
</body>
</html>
